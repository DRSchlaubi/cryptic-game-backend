plugins {
    id 'java'
    id 'application'
    id 'io.freefair.aggregate-javadoc' version '5.0.0-rc2'
}

group 'net.cryptic-game'
version '0.3.0'

application {
    mainClassName = ""
}

subprojects {
    version project.parent.version
    sourceCompatibility = targetCompatibility = 1.11

    repositories {
        mavenCentral()
    }
}

task cleanDocs(type: Delete) {
    delete "$projectDir/javadoc/latest/"
}

task createDocs(type: Copy, dependsOn: cleanDocs) {
    from "$project.buildDir/docs/javadoc/"
    into "$projectDir/javadoc/latest/"
}

task linkSentry(type: Exec) {
    commandLine "sentry-cli", "releases", "new", "-p", "${System.env.SENTRY_PROJECT}", "${version.toString()}", "&&", "sentry-cli", "releases", "set-commits", "--auto", "${version.toString()}", "&&", "sentry-cli", "releases", "finalize", "${version.toString()}", "&&", "sentry-cli", "releases", "deploys", "${version.toString()}", "new", "-e", "${System.env.SENTRY_DEPLOY_ENVIRONMENT}"
}
